--year;
--min order;
-- max order;
--total sum;
-- number of orders;
--average revenue per uniq customer, rounded to the nearest.
--sort by year from bigger. only where field billing_country is - США (англ. USA), Великобритания (англ. United Kingdom) и Германия (англ. Germany).

SELECT 
        EXTRACT (YEAR FROM CAST(invoice_date AS timestamp)), 
        min(total), 
        max(total), 
        sum(total), 
        count(invoice_id), 
        ROUND(sum(total)/count(distinct(customer_id)))
FROM invoice
WHERE billing_country = 'USA' or billing_country = 'Germany' or billing_country = 'United Kingdom'

GROUP BY EXTRACT (YEAR FROM CAST(invoice_date AS timestamp))
ORDER BY date_part DESC

-- --

SELECT SUM(total)
FROM invoice
WHERE (CAST(invoice_date AS date) >= '2011-09-01')
      AND (CAST(invoice_date AS date) <= '2011-09-30')
GROUP BY (EXTRACT(DAY FROM CAST(invoice_date AS date)))
HAVING SUM(total)<10 AND SUM(total)>1

-- --

SELECT billing_country,
       
       COUNT(*)-COUNT(billing_postal_code) -- here we can count is null fields (all strings minus strings where postal code isnt null)
FROM invoice
WHERE (billing_address LIKE '%Street%')
      OR (billing_address LIKE '%Way%')
      OR (billing_address LIKE '%Road%')
      OR (billing_address LIKE '%Drive%') 
GROUP BY billing_country 
HAVING (COUNT(*)-COUNT(billing_postal_code))>6
